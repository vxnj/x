<!DOCTYPE html>
<meta charset="UTF-8">
<html>
<head>
<title>Page Title</title>
</head>


<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="js/funcs.js"></script>
<script src="js/fDate.js"></script>
<link rel="stylesheet" href="style.css" />

<script>

var xhr = new XMLHttpRequest();
xhr.onreadystatechange = function() { // Check if fetch request is done
    if (xhr.readyState == 4 && xhr.status == 200) { 
        jsonData = JSON.parse(xhr.responseText);
        processQ(jsonData);
    }
}

let  resp = 'a';
data = "";

function getQ() {
  now = date_format(new Date(), 'U');
  console.log(now);
  prx = "https://api.allorigins.win/raw?url=";
  url = "https://query2.finance.yahoo.com/v7/finance/quote?symbols=^ixic,^DJI,^GSPC,aapl,GOOG,FB,AMZN,hsbc,ibm,tsla,BTC-USD,ETH-USD,CL=F,GC=F,NQ=F,ES=F,YM=F,^TNX,QQQ,SPY,MKTX" + ',X' + now
  xhr.open("GET", prx + url, true);
  xhr.send();
}

function processQ(data) {
  console.log('processQ start');
  // console.log(data.quoteResponse.result.length);
  for (q = 0, len =data.quoteResponse.result.length, vres = ""; q < len; q++) {
  

    
    dateVal = new Date((data.quoteResponse.result[q].regularMarketTime) *1000);
    dateVal = date_format(dateVal, 'H:i');

    vres += 
      dateVal  +  ' ' + 
      //data.quoteResponse.result[q].regularMarketTime+' '  +
      data.quoteResponse.result[q].symbol + ' ' +  
      data.quoteResponse.result[q].shortName + ' ' +  
      
      data.quoteResponse.result[q].marketState +  ' ' + 
      data.quoteResponse.result[q].regularMarketPrice.toFixed(2) +  ' ' +
      data.quoteResponse.result[q].regularMarketChange.toFixed(2) + ' ' +  
      data.quoteResponse.result[q].regularMarketChangePercent.toFixed(1)  + '% ' +  
      data.quoteResponse.result[q].quoteType + ' ' +  
      data.quoteResponse.result[q].exchangeDataDelayedBy  + ' ' +  
      '<br>';
  
  }
  document.getElementById("app1").innerHTML = vres ;


  
}

</script>


<body>
  <p ></p>
    <button id="get" onclick="getQ()">GET</button><br><br>
    <div style="color:rgb(155, 201, 167) !important" id="app1">1</div><br>
    <div id="app2">2</div><br>
    <div id="app3">3</div><br>
    <div id="app4" style="max-width: 100%;">4</div><br>

    
</body>
</html>
    